# 摄影图册功能使用指南

## 功能概述

本博客系统新增了完整的摄影图册功能，支持图片展示、图册管理、以及与博客文章的关联。

## 主要功能

### 1. 图册管理
- **创建图册**: 在 `/admin/photos` 页面可以创建新的摄影图册
- **图册列表**: 在 `/albums` 页面浏览所有公开的图册
- **图册详情**: 点击图册可以查看详细内容和包含的图片

### 2. 图片管理
- **图片列表**: 在 `/photos` 页面浏览所有公开的图片
- **图片详情**: 点击图片可以查看详细信息、拍摄参数和关联的博客文章
- **图片上传**: 在管理页面可以直接上传图片文件并设置详细信息

### 3. 博客关联
- **图片关联博客**: 可以将图片关联到博客文章
- **博客显示图片**: 在博客文章中可以通过关联关系获取相关图片
- **双向关联**: 支持图片到博客和博客到图片的双向关联

## 文件上传功能

### 支持的文件类型
- JPEG (.jpg, .jpeg)
- PNG (.png)
- GIF (.gif)
- WebP (.webp)

### 文件大小限制
- 最大文件大小: 5MB

### 上传流程
1. **选择文件**: 点击文件选择按钮选择图片文件
2. **预览图片**: 选择文件后会自动显示图片预览
3. **上传文件**: 点击"上传文件"按钮将文件上传到服务器
4. **填写信息**: 上传成功后填写图片的详细信息
5. **保存图片**: 点击"保存图片信息"完成图片创建

### 图册封面
- 创建图册时可以上传封面图片
- 封面图片会自动保存并关联到图册

## 数据库结构

### 核心模型

#### PhotoAlbum (摄影图册)
```sql
- id: 唯一标识
- title: 图册标题
- slug: URL友好的标识符
- description: 图册描述
- coverImage: 封面图片URL
- isPublished: 是否发布
- isPrivate: 是否私有
- creatorId: 创建者ID
```

#### Photo (摄影图片)
```sql
- id: 唯一标识
- title: 图片标题
- description: 图片描述
- location: 拍摄地点
- camera: 相机型号
- lens: 镜头型号
- settings: 拍摄参数
- tags: 标签
- isFeatured: 是否精选
- mediaId: 媒体文件ID
- albumId: 所属图册ID
- takenAt: 拍摄时间
```

#### Media (媒体文件)
```sql
- id: 唯一标识
- filename: 文件名
- originalName: 原始文件名
- mimeType: MIME类型
- size: 文件大小
- url: 文件URL
- thumbnailUrl: 缩略图URL
- alt: 替代文本
- caption: 图片说明
- uploaderId: 上传者ID
```

#### PostPhoto (文章图片关联)
```sql
- id: 唯一标识
- postId: 文章ID
- photoId: 图片ID
- sortOrder: 排序
```

## API 接口

### 文件上传
- `POST /api/upload` - 上传图片文件

### 图册相关
- `GET /api/albums` - 获取图册列表
- `POST /api/albums` - 创建新图册

### 图片相关
- `GET /api/photos` - 获取图片列表
- `POST /api/photos` - 创建新图片

### 文章图片关联
- `GET /api/posts/[postId]/photos` - 获取文章关联的图片
- `POST /api/posts/[postId]/photos` - 关联图片到文章
- `DELETE /api/posts/[postId]/photos?photoId=xxx` - 删除图片关联

## 使用示例

### 1. 浏览图册
1. 访问 `/albums` 页面
2. 使用搜索功能查找特定图册
3. 点击图册查看详细内容

### 2. 浏览图片
1. 访问 `/photos` 页面
2. 使用搜索和筛选功能
3. 点击图片查看详细信息

### 3. 创建图册
1. 访问 `/admin/photos` 页面
2. 切换到"图册管理"标签
3. 填写图册信息
4. 可选择上传封面图片
5. 点击"创建图册"

### 4. 上传图片
1. 访问 `/admin/photos` 页面
2. 切换到"图片管理"标签
3. 选择图片文件并上传
4. 填写图片详细信息（标题、描述、拍摄参数等）
5. 选择所属图册（可选）
6. 点击"保存图片信息"

### 5. 关联图片到博客
1. 在图片详情页面查看关联的博客文章
2. 在博客编辑页面可以关联相关图片

## 测试数据

系统已包含测试数据：
- 测试用户: testuser
- 测试图册: "自然风光"
- 测试图片: "山脉日出"
- 测试博客文章: "测试博客文章"

## 技术特性

- **响应式设计**: 支持桌面端和移动端
- **暗色模式**: 完整的暗色模式支持
- **搜索功能**: 支持图册和图片的搜索
- **分页支持**: 大量数据的分页显示
- **权限控制**: 基于用户的权限管理
- **SEO优化**: 完整的元数据支持
- **文件上传**: 支持拖拽上传和预览
- **图片预览**: 上传前可预览图片效果

## 文件存储

- 上传的文件保存在 `public/uploads/` 目录
- 文件名使用时间戳和随机字符串生成，避免冲突
- 支持自动创建上传目录

## 注意事项

1. 图片上传需要用户登录
2. 图册和图片的创建需要用户登录
3. 私有图册只对创建者可见
4. 图片关联博客需要相应的权限
5. 精选图片会在列表中优先显示
6. 文件大小限制为5MB
7. 支持的文件类型有限制

## 扩展功能

未来可以考虑添加的功能：
- 图片点赞和评论
- 图片下载功能
- 图片水印
- 批量上传
- 图片编辑功能
- 图片分享功能
- 图片压缩和优化
- 缩略图自动生成
- 图片EXIF信息提取 